<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora Científica</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .calculator-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 0.75rem;
        }

        .span-two {
            grid-column: span 2;
        }

        .span-three {
            grid-column: span 3;
        }

        .btn {
            padding: 1.25rem;
            border-radius: 0.5rem;
            font-size: 1.5rem;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
<div class="w-full max-w-lg mx-auto bg-white rounded-lg shadow-lg p-3">
    <h1 class="text-3xl font-bold text-center mb-6 text-gray-800">Calculadora Científica</h1>
    <div class="bg-gray-800 rounded-lg p-4 mb-4 text-right text-xl text-white" id="display">
        <div id="full-expression" class="text-sm text-gray-400"></div>
        <div id="current-value">0</div>
    </div>
    <div id="calculator" class="calculator-grid">
        <!-- Funciones científicas -->
        <button class="btn bg-blue-500 text-white" data-value="raiz_cuadrada">√</button>
        <button class="btn bg-blue-500 text-white" data-value="potencia">^</button>
        <button class="btn bg-blue-500 text-white" data-value="logaritmo">log</button>
        <button class="btn bg-blue-500 text-white" data-value="logaritmo_natural">ln</button>
        <button class="btn bg-blue-500 text-white" data-value="exponencial">exp</button>
        <button class="btn bg-blue-500 text-white" data-value="seno">sin</button>
        <button class="btn bg-blue-500 text-white" data-value="coseno">cos</button>
        <button class="btn bg-blue-500 text-white" data-value="tangente">tan</button>
        <button class="btn bg-blue-500 text-white" data-value="arcoseno">asin</button>
        <button class="btn bg-blue-500 text-white" data-value="arcocoseno">acos</button>
        <button class="btn bg-blue-500 text-white" data-value="arcotangente">atan</button>
        <button class="btn bg-blue-500 text-white" data-value="sinh">sinh</button>
        <button class="btn bg-blue-500 text-white" data-value="cosh">cosh</button>
        <button class="btn bg-blue-500 text-white" data-value="tanh">tanh</button>
        <button class="btn bg-blue-500 text-white" data-value="factorial">n!</button>
        <button class="btn bg-blue-500 text-white" data-value="modulo">%</button>
        <button class="btn bg-blue-500 text-white" data-value="potencia_de_diez">10^x</button>
        <button class="btn bg-blue-500 text-white" data-value="inversa">1/x</button>
        <button class="btn bg-yellow-500 text-white" data-value="borrar">⌫</button>
        <button class="btn bg-red-500 text-white" data-value="limpiar">C</button>

        <!-- Números -->
        <button class="btn bg-gray-300 text-gray-800" data-value="7">7</button>
        <button class="btn bg-gray-300 text-gray-800" data-value="8">8</button>
        <button class="btn bg-gray-300 text-gray-800" data-value="9">9</button>
        <button class="btn bg-orange-500 text-white" data-value="multiplicacion">*</button>
        <button class="btn bg-orange-500 text-white" data-value="division">/</button>
        <button class="btn bg-gray-300 text-gray-800" data-value="4">4</button>
        <button class="btn bg-gray-300 text-gray-800" data-value="5">5</button>
        <button class="btn bg-gray-300 text-gray-800" data-value="6">6</button>
        <button class="btn bg-orange-500 text-white" data-value="suma">+</button>
        <button class="btn bg-orange-500 text-white" data-value="resta">-</button>
        <button class="btn bg-gray-300 text-gray-800" data-value="1">1</button>
        <button class="btn bg-gray-300 text-gray-800" data-value="2">2</button>
        <button class="btn bg-gray-300 text-gray-800" data-value="3">3</button>
        <button class="btn bg-green-500 text-white span-two" data-value="igual">=</button>
        <button class="btn bg-gray-300 text-gray-800 span-two" data-value="0">0</button>
        <button class="btn bg-gray-300 text-gray-800" data-value="punto">.</button>
    </div>
    <div id="result" class="mt-4 text-center text-xl"></div>
</div>

<script>
    let expresionActual = '';
    let valorActual = '0';
    let resultadoCalculado = false;

    function actualizarPantalla() {
        document.getElementById('full-expression').textContent = expresionActual;
        document.getElementById('current-value').textContent = formatarNumero(valorActual);
    }

    function formatarNumero(num) {
        return new Intl.NumberFormat().format(num);
    }

    function manejarNumero(numero) {
        if (resultadoCalculado) {
            expresionActual = '';
            valorActual = numero;
            resultadoCalculado = false;
        } else {
            if (valorActual === '0') {
                valorActual = numero;
            } else {
                valorActual += numero;
            }
        }
        actualizarPantalla();
    }

    function manejarOperacion(operacion) {
        if (resultadoCalculado) {
            expresionActual = valorActual;
            resultadoCalculado = false;
        } else {
            expresionActual += valorActual;
        }

        switch (operacion) {
            case 'suma':
                expresionActual += ' + ';
                break;
            case 'resta':
                expresionActual += ' - ';
                break;
            case 'multiplicacion':
                expresionActual += ' * ';
                break;
            case 'division':
                expresionActual += ' / ';
                break;
            case 'potencia':
                expresionActual += ' ^ ';
                break;
            case 'modulo':
                expresionActual += ' % ';
                break;
            default:
                return;
        }

        valorActual = '0';
        actualizarPantalla();
    }

    function manejarOperacionUnaria(operacion) {
        let valor = parseFloat(valorActual);
        let expresionDisplay = '';

        switch (operacion) {
            case 'raiz_cuadrada':
                expresionDisplay = `√(${valorActual})`;
                break;
            case 'logaritmo':
                expresionDisplay = `log(${valorActual})`;
                break;
            case 'logaritmo_natural':
                expresionDisplay = `ln(${valorActual})`;
                break;
            case 'exponencial':
                expresionDisplay = `exp(${valorActual})`;
                break;
            case 'seno':
                expresionDisplay = `sin(${valorActual})`;
                break;
            case 'coseno':
                expresionDisplay = `cos(${valorActual})`;
                break;
            case 'tangente':
                expresionDisplay = `tan(${valorActual})`;
                break;
            case 'arcoseno':
                expresionDisplay = `asin(${valorActual})`;
                break;
            case 'arcocoseno':
                expresionDisplay = `acos(${valorActual})`;
                break;
            case 'arcotangente':
                expresionDisplay = `atan(${valorActual})`;
                break;
            case 'sinh':
                expresionDisplay = `sinh(${valorActual})`;
                break;
            case 'cosh':
                expresionDisplay = `cosh(${valorActual})`;
                break;
            case 'tanh':
                expresionDisplay = `tanh(${valorActual})`;
                break;
            case 'factorial':
                expresionDisplay = `${valorActual}!`;
                break;
            case 'modulo':
                expresionDisplay = `(${valorActual}) %`;
                break;
            case 'potencia_de_diez':
                expresionDisplay = `10^(${valorActual})`;
                break;
            case 'inversa':
                expresionDisplay = `1/(${valorActual})`;
                break;
            default:
                return;
        }

        expresionActual = expresionDisplay;
        actualizarPantalla();
        ejecutarOperacion(operacion, valor);
    }

    function ejecutarOperacion(operacion, a, b = null) {
        const formData = new FormData();
        formData.append('operation', operacion);
        formData.append('a', a);
        if (b !== null) {
            formData.append('b', b);
        }

        fetch('/calculate/', {
            method: 'POST',
            body: formData,
        })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    throw new Error(data.error);
                }
                valorActual = redondearNumero(data.result);
                resultadoCalculado = true;
                actualizarPantalla();
            })
            .catch(error => {
                valorActual = 'Error';
                console.error('Error:', error);
                actualizarPantalla();
            });
    }

    function redondearNumero(num, decimales = 10) {
        return Number(num.toFixed(decimales));
    }

    function manejarIgual() {
        if (resultadoCalculado) {
            expresionActual = valorActual;
        } else {
            expresionActual += valorActual;
        }

        try {
            const resultado = eval(expresionActual.replace('^', '**'));
            valorActual = resultado.toString();
            expresionActual = '';
            resultadoCalculado = true;
            actualizarPantalla();
        } catch (error) {
            valorActual = 'Error';
            actualizarPantalla();
        }
    }

    function manejarLimpiar() {
        expresionActual = '';
        valorActual = '0';
        resultadoCalculado = false;
        actualizarPantalla();
    }

    function manejarBorrar() {
        if (resultadoCalculado) {
            expresionActual = '';
            valorActual = '0';
            resultadoCalculado = false;
        } else {
            if (valorActual.length > 1) {
                valorActual = valorActual.slice(0, -1);
            } else {
                valorActual = '0';
            }
        }
        actualizarPantalla();
    }

    document.querySelectorAll('.btn').forEach(button => {
        button.addEventListener('click', () => {
            const valor = button.getAttribute('data-value');

            if (!isNaN(valor)) {
                manejarNumero(valor);
            } else if (valor === 'igual') {
                manejarIgual();
            } else if (valor === 'limpiar') {
                manejarLimpiar();
            } else if (valor === 'borrar') {
                manejarBorrar();
            } else if (['suma', 'resta', 'multiplicacion', 'division', 'potencia', 'modulo'].includes(valor)) {
                manejarOperacion(valor);
            } else {
                manejarOperacionUnaria(valor);
            }
        });
    });

    actualizarPantalla();
</script>
</body>
</html>
